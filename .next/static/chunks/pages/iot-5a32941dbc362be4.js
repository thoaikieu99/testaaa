(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{3313:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iot",function(){return n(1074)}])},1074:function(e,t,n){"use strict";n.r(t);var o=n(5893),s=n(1310),c=n(7294);t.default=()=>{let[e,t]=(0,c.useState)(null),[n,r]=(0,c.useState)(!1),[l,i]=(0,c.useState)(!1),[a,u]=(0,c.useState)({}),[d,f]=(0,c.useState)("Connect"),[g,h]=(0,c.useState)(!1),[m,p]=(0,c.useState)(!1),_=()=>{let{protocol:e,host:n,clientId:o,port:c,username:r,password:l}={protocol:"wss",host:"477f457ef11344998de412532af27470.s1.eu.hivemq.cloud",clientId:"emqx_react_"+Math.random().toString(16).substring(2,8),port:8884,username:"kianai99",password:"thoailap99"},i="".concat(e,"://").concat(n,":").concat(c,"/mqtt");f("Connecting"),t(s.Z.connect(i,{clientId:o,username:r,password:l,clean:!0,reconnectPeriod:1e3,connectTimeout:3e4}))};(0,c.useEffect)(()=>{_()},[]),(0,c.useEffect)(()=>{e&&(e.on("connect",()=>{f("Connected")}),e.on("error",t=>{console.error("Connection error: ",t),e.end()}),e.on("reconnect",()=>{f("Reconnecting")}),e.on("message",(e,t)=>{let n={topic:e,message:t.toString()};if(console.log(n.message),n.message){let e=JSON.parse(n.message);console.log(e),"On"==e.Motor&&(h(!0),p(!0)),"Off"==e.Motor&&(h(!1),p(!0))}u(n)}))},[e]),(0,c.useEffect)(()=>{console.log(d),"Connected"==d&&(b(),S())},[d]);let b=()=>{if(e){let{topic:t,qos:n}={topic:"esp8266_data",qos:0};e.subscribe(t,{qos:n},e=>{if(e){console.log("Subscribe to topics error",e);return}r(!0)})}},S=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'{Check: "Yes" }';if(e){g||"send"!=t||(t='{"Motor":"On"}'),!0==g&&"send"==t&&(t='{"Motor":"Off"}');let{topic:n,qos:o}={topic:"led_state",qos:0};e.publish(n,t,{qos:o},e=>{e&&console.log("Publish error: ",e)})}},x=(0,o.jsx)(o.Fragment,{children:"Loading...."});return m&&(x=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Led"}),(0,o.jsxs)("div",{className:"toggle-slider",children:[(0,o.jsx)("input",{type:"checkbox",id:"toggle",checked:g,onChange:()=>{S("send"),h(!g)}}),(0,o.jsx)("label",{htmlFor:"toggle",className:"slider"})]})]})),(0,o.jsx)("div",{className:"all",children:x})}}},function(e){e.O(0,[900,888,774,179],function(){return e(e.s=3313)}),_N_E=e.O()}]);